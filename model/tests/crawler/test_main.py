import unittest
from unittest import mock

import polars as pl
import requests

import crawler.main


class TestCrawler(unittest.TestCase):
    def test_game_is_parsed_properly(self):
        response_string = '<!DOCTYPE HTML>\n<HTML lang="en"><HEAD><TITLE>GameKnot: chess game annotation #119</TITLE>\n<meta charset="UTF-8">\n<!-- GameKnot Chess v231026 -->\n<meta name="viewport" content="width=device-width">\n\n\n<link rel="stylesheet" type="text/css" href="/css/main0.231026.css">\n<link rel="shortcut icon" href="/img/gk32x32.png">\n<link rel="icon" sizes="192x192" href="/img/gk-icon-192x192.png" type="image/png">\n<link rel="icon" sizes="128x128" href="/img/gk-icon-128x128.png" type="image/png">\n<link rel="apple-touch-icon" sizes="180x180" href="/img/gk-icon-180x180.png">\n<link rel="manifest" href="/manifest.231026.json">\n<meta http-equiv="X-UA-Compatible" content="IE=edge">\n<meta name="apple-mobile-web-app-capable" content="yes">\n<meta name="apple-mobile-web-app-status-bar-style" content="default">\n<meta name="mobile-web-app-capable" content="yes">\n<meta name="pinterest" content="nohover">\n<meta name="format-detection" content="telephone=no,date=no">\n<script type="text/javascript" src="/js/common.231026.js"></script>\n\n<script type="text/javascript">\nif (screen.width<1000)\n{\n    var e = document.querySelector("meta[name=viewport]");\n    if (e) e.parentNode.removeChild(e);\n    e = document.createElement("meta");\n    e.setAttribute("name", "viewport");\n    e.setAttribute("content", "width=1000");\n    document.head.appendChild(e);\n}\n</script>\n\n\n</HEAD>\n<BODY class=gk_pop>\n<script>\nfunction ipad_workaround()\n{\n    var id = \'_div_ipad_workaround\';\n    var o = gk_get_el(id);\n    if (o) return;\n\n    var t = 0;\n    try { t = /CriOS\\/85\\.0/.test(navigator.userAgent); } catch(e) {}\n    if (!t) return;\n    \n    if (!window.visualViewport || window.visualViewport.height<900 && window.visualViewport.width<900) return;\n    \n    var o = document.createElement(\'div\');\n    o.id = id;\n    o.style.height = \'110px\';\n\n    o.innerHTML = \'&nbsp;\';\n\n    document.body.insertBefore( o, document.body.firstChild );\n}\nsetTimeout( ipad_workaround, 10 );\n</script>\n\n\n<!-- script type="text/javascript" src="/js/common_err.js"></script -->\n<script src="/js/chess-board.021420.js"></script>\n<script src="/js/annotate.010721.js"></script>\n<script src="/js/pgn.061819.js"></script>\n<script src="/js/export_web.062021.js"></script>\n<script src="/js/chess-board-ui.js?030809"></script>\n<script src="/js/rate-stars.js?072114"></script>\n<script src="/js/spellcheck.js?041113"></script>\n\n<div id="anno">Loading... (<a href="/pg/help_cache.htm" target="_blank" onClick="location.reload(true);">help?</a>)</div>\n\n<script type="text/javascript"><!--\n\nb_edit = 0;\n\ngame_error_msg = \'\';\ngame_id = 119;\ngame_modified = 0;\ngame_public = 1;\ngame_bd = 5332951;\ngame_title = decode_str(\'Challenge from bittersweet_ballad\');\ngame_movelist = \'d2d4-g8f6-c2c4-e7e6-b1c3-b7b6-g1f3-c8a6-e2e4-f8b4-f1d3-a6b7-d1c2-e8g8-e1g1-f6g4-c1g5-f7f6-g5h4-c7c5-e4e5-g8h8-e5f6-g4f6-c3e4-c5d4-e4f6-g7f6-f3d4-d8c7-h4g3-c7d8-d4b5-a7a6-b5d6-b4d6-g3d6-f8g8-f2f3-g8g7-a1d1-b8c6-d3e4-a8c8-b2b3-c6a5-f1f2-b7c6-f2d2-a5b7-d6a3-d7d5-c4d5-c6d5-c2b1-g7d7-a3b2-c8c5-b1d3-\';\ngame_result = 1;\ngame_player_w = decode_str(\'bittersweet_ballad\');\ngame_player_b = decode_str(\'aqeel\');\ngame_rating_w = decode_str(\'1855\');\ngame_rating_b = decode_str(\'1893\');\ngame_cur_note = decode_str(\'\');\ngame_time = decode_str(\'14 days per move\');\ngame_started = decode_str(\'23-Jun-06\');\ngame_ended = decode_str(\'19-Aug-06\');\ngame_notes = [ "","I%20annotated%20this%20game%20as%20it%20proceeded.%20The%20annotations%20therefore%20don%27t%20have%20any%20retrospective%20analysis%2c%20and%20are%20only%20the%20thoughts%20going%20on%20in%20my%20mind%20while%20I%20was%20playing.","","","","","","","Although%20this%20move%20is%20part%20of%20a%20book%20opening%2c%20I%20don%27t%20understand%20what%20it%20tries%20to%20achieve.%20The%20bishop%20would%20probably%20have%20to%20move%20back%20to%20b7%20anyway%2c%20so%20isn%27t%20that%20like%20loosing%20a%20tempo%3f","","","","","","","","huh%3f%20what%20does%20this%20achieve%3f%20the%20N%20will%20have%20to%20go%20away%20anyway%20after%20h3.","weakens%20g6%20for%20black.%20the%20h7%20pawn%20is%20already%20potentially%20attacked%20by%20white%27s%20B.","","other%20option%20was%20Bd2%2c%20but%20this%20is%20probably%20better.%20now%20white%20can%20do%20a%20number%20of%20interesting%20things%2c%20like%20e5","good%20move.%20aims%20at%20breaking%20up%20white%27s%20pawn%20center.","had%20to%20think%20a%20lot%20for%20this%20move.%20still%20unsure%20whether%20this%20was%20the%20best%20option.%20Other%20options%20were%20d5%2c%20a3%20and%20h3.%20The%20ones%20I%20had%20to%20decide%20between%20in%20the%20end%20were%20e5%20and%20d5.%20Both%20look%20good%20for%20white%2c%20but%20e5%20has%20various%20very%20tactical%20lines.%20d5%20locks%20the%20position%2c%20and%20the%20game%20develops%20slower.%20i%20think%20that%20the%20advantage%20is%20more%20sure%20with%20d5%2c%20but%20would%20be%20slow%20to%20convert%20into%20anything%20tangible.%20it%20would%20most%20probably%20be%20followed%20by%20d6%2c%20and%20exchange%20of%20the%20bishop%20for%20knight%20by%20black%20on%20c3.%20With%20e5%2c%20black%27s%20best%20reply%20seems%20to%20be%20cxd4.%20Bxf3%20is%20also%20good.%20After%20Bxf3%2c%20white%27s%20pawns%20double%2c%20exposing%20the%20king%20on%20an%20open%20g%20file.%20After%20cxd4%2c%20white%20could%20play%20exf6%20or%20Bxh7%2c%20both%20of%20which%20look%20good.%20Probably%20moving%20the%20c%20knight%20at%20some%20point%20would%20be%20a%20good%20idea%2c%20to%20avoid%20black%20exchaninging%20it%20for%20a%20useless%20bishop.","interesting%20move.%20i%20did%20not%20expect%20it.%20prevents%20white%20from%20taking%20on%20h7%20with%20check.%20however%2c%20i%20think%20that%20it%20is%20a%20%27slow%27%20move%2c%20and%20black%20needed%20a%20%27fast%27%20move%20at%20this%20time.%20now%20white%20can%20simply%20play%20exf6%2c%20and%20black%20would%20be%20forced%20to%20play%20Nxf6%20or%20gxf6%20(otherwise%20white%20wins%20the%20black%20Q).%20Nxf6%20definately%20looks%20the%20better%20of%20the%20two.%20After%20that%20white%20can%20decide%20about%20what%20to%20do%20with%20black%27s%20threat%20of%20cxd4.%20Options%20would%20include%20Ne4%2c%20Ne5%2c%20a3%2c%20Bxh7%20etc..","","","","","","","","the%20space%20around%20black%27s%20king%20has%20opened%20up.%20however%2c%20black%20now%20also%20has%20open%20files%20to%20place%20his%20rooks%20on%20to%20attack%20white%27s%20king%20in%20conjunction%20with%20his%20bishops.%20however%20black%27s%20N%20is%20still%20undeveloped.","","maybe%20Qc5%20would%20have%20been%20better","with%20the%20aim%20of%20lodging%20in%20at%20d6.%20black%20should%20next%20play%20a%20move%20which%20blocks%20white%27s%20black%20B%2c%20or%20opens%20space%20around%20his%20rook%2c%20otherwise%20white%20can%20win%20the%20exchange%20by%20playing%20Nc7.%2017..f5%20looks%20to%20be%20the%20best%20for%20black.%20This%20sequence%20of%20moves%20leaves%20white%27s%20white%20B%20weaker.","opens%20space%20around%20rook%2c%20and%20scares%20the%20N%20off","","Black%20exchanges%20his%20weak%20black%20B%20for%20white%27s%20N%20which%20would%20have%20cramped%20things%20for%20black%20had%20it%20stayed%20on%20d6.%20However%2c%20white%20is%20now%20left%20with%202%20bishops%2c%20which%20could%20work%20well%20to%20dominate%20the%20board","","","","to%20protect%20Bxh7.%20But%20now%20black%20cannot%20play%20f5%20(which%20would%20have%20reduced%20white%27s%20white%20B%27s%20mobility%20and%20strengthened%20the%20f-pawn)%20since%20black%27s%20rook%20and%20king%20are%20on%20the%20same%20diagonal.","rook%20to%20semi-open%20file.","black%20develops%20N%20at%20last!","pins%20N.%20opens%20up%20space%20for%20R%20to%20exert%20influence.%20Cheekily%20invites%20f5%20from%20black.%20Black%27s%20camp%20is%20now%20quite%20cramped.%20The%20N%20can%27t%20move%2c%20the%20Q%20has%20few%20squares%20to%20go%20to%2c%20and%20must%20protect%20f6.%20Black%20has%20to%20think%20of%20a%20way%20to%20liberate%20himself%2c%20and%20white%20has%20to%20think%20of%20a%20way%20to%20use%20the%20space%20he%20has%20to%20attack.","","protects%20the%20c-pawn%20against%20a%20potential%20Na5.%20The%202%20general%20concepts%20in%20my%20mind%20at%20this%20time%20were%20to%20weaken%20the%20black%20pawns%20by%20moving%20my%20f-pawn%20up%20the%20board.%20This%20threat%20is%20quite%20real%20and%20near%2c%20so%20black%20should%20move%20his%20king%20and%20play%20f5%20as%20soon%20as%20possible.%20If%20white%20had%20played%20f4%20immediately%2c%20then%2023..Na5%2024.b3%20Bxe4%2025.Qxe4%20f5%2c%20and%20black%20is%20now%20less%20cramped%2c%20and%20white%20hasn%27t%20succeeded%20in%20weakening%20black%27s%20center%20pawns%20as%20he%20would%20have%20wished.%20The%20other%20thing%20I%20wanted%20to%20do%20was%20to%20double%20up%20on%20the%20d-file%2c%20and%20exert%20pressure%20on%20black%27s%20backward%20d-pawn.","Black%20most%20probably%20played%20this%20to%20make%20his%20position%20more%20%27fluid%27%20-%20to%20free%20his%20pieces.%20However%20the%20N%20has%20no%20squares%20where%20it%20is%20currently%20at.%20Black%20would%20be%20aiming%20to%20exchange%20bishops%2c%20and%20then%20play%20the%20N%20to%20b7%2c%20or%20maybe%20even%20c6.","With%20the%20aim%20of%20doubling%20on%20the%20d-file.%20Once%20the%20rooks%20are%20doubled%2c%20white%20can%20move%20the%20B%20from%20d6%2c%20and%20bring%20it%20to%20the%20long%20diagonal%20where%20it%20would%20be%20powerful.%20Also%2c%20the%20Q%20would%20be%20protecting%20both%2c%20d7%20and%20f6%2c%20which%20could%20cause%20black%20problems.","makes%20room%20for%20the%20N.%20Alternatively%20black%20could%20have%20played%2024..Bxe4","","At%20this%20point%20I%20had%20to%20make%20a%20few%20important%20decisions.%20First%20of%20all%20I%20had%20to%20decide%20whether%20I%20wanted%20black%20to%20take%20my%20B.%20Nxd6%20would%20leave%20me%20without%20my%20dark%20bishop.%20In%20this%20position%2c%20the%20dark%20bishop%20appears%20to%20be%20quite%20powerful.%20Placed%20on%20the%20a1-h8%20diagonal%2c%20it%20could%20cause%20black%20problems.%20However%20if%20I%20moved%20the%20bishop%2c%20after%20a%20few%20moves%20black%20could%20advance%20the%20d-pawn%20(but%20if%20Nxd6%2c%20then%20Rxd6%20keeps%20the%20d-pawn%20back%2c%20and%20weak).%20And%20there%20were%20also%202%20options%20if%20I%20decided%20to%20move%20my%20B%20-%20I%20could%20either%20bring%20it%20to%20the%20b2%20square%20through%20a3%2c%20or%20I%20could%20take%20it%20to%20f4%2c%20and%20then%20play%20Bh6%20at%20some%20point.%20So%20at%20this%20junction%2c%20I%20was%20considering%203%20moves%3a%20Ba3%2c%20Bf4%20and%20a%20move%20in%20which%20I%20wouldn%27t%20move%20my%20B%2c%20probably%20Qb2","This%20was%20a%20very%20difficult%20decision%20for%20me.%20I%20didn%27t%20play%20Qb2%20because%20e5%20by%20black%20didn%27t%20look%20good.%20I%20also%20didn%27t%20want%20to%20exchange%20much%20material%20right%20now%2c%20because%20I%20fealt%20that%20the%20pressure%20was%20on%20black%2c%20and%20exchanges%20would%20let%20some%20of%20the%20steam%20off.%20I%20didn%27t%20play%20Bf4%20because%20it%20didn%27t%20seem%20to%20do%20much.%20Now%20black%20may%20be%20able%20to%20play%20d5%20at%20some%20point%2c%20which%20would%20give%20him%20space%2c%20and%20strengthen%20his%20d-pawn.%20However%20white%27s%20bishop%20would%20be%20strong%20at%20b2.","","","","","","","","Attacks%20a6%2c%20and%20threatens%20Qe3.%20After%20Qe3%20white%20could%20play%20Bxd5%2c%20with%20the%20white%20Q%20eventually%20taking%20on%20e6%2c%20and%20leaving%20the%20black%20king%20in%20real%20danger.%20Maybe%20it%20was%20a%20bit%20premature%20for%20black%20to%20resign%20-%20the%20position%20however%2c%20does%20favour%20white%20quite%20heavily." ];\n\nstar_rating = -1;\n\ninit_page( \'anno\', 0, 0 );\n\n// --></script>\n\n<script>\nfunction gk_lazyload_all()\n{\n    var all = document.querySelectorAll(\'[data-chess-diagram]\');\n    if (!all || !all.length) return;\n    if (!load_js(\'/js/chess-diagram.022621.js\')) render_all_chess_diagrams();\n}\nsetTimeout( gk_lazyload_all, 1 );\n</script>\n<script async src="https://www.googletagmanager.com/gtag/js?id=UA-261935-1"></script>\n<script>\nwindow.dataLayer = window.dataLayer || [];\nfunction gtag(){dataLayer.push(arguments);}\ngtag(\'js\', new Date());\ngtag(\'set\', {\'user_id\': \'0\'});\ngtag(\'config\',\'UA-261935-1\');\n</script>\n\n<script>\nconsole.log(\'--- Footer included (10/12/2021)\');\n</script>\n\n</BODY>\n</HTML>\n'
        parsed_response = crawler.main.parse_response_text(response_string)
        expected = pl.DataFrame([{'previous_board': 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1', 'current_board': 'rnbqkbnr/pppppppp/8/8/3P4/8/PPP1PPPP/RNBQKBNR b KQkq - 0 1', 'comment': "I annotated this game as it proceeded. The annotations therefore don't have any retrospective analysis, and are only the thoughts going on in my mind while I was playing."}, {'previous_board': 'rnbqkbnr/pppppppp/8/8/3P4/8/PPP1PPPP/RNBQKBNR b KQkq - 0 1', 'current_board': 'rnbqkb1r/pppppppp/5n2/8/3P4/8/PPP1PPPP/RNBQKBNR w KQkq - 1 2', 'comment': ''}, {'previous_board': 'rnbqkb1r/pppppppp/5n2/8/3P4/8/PPP1PPPP/RNBQKBNR w KQkq - 1 2', 'current_board': 'rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR b KQkq - 0 2', 'comment': ''}, {'previous_board': 'rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR b KQkq - 0 2', 'current_board': 'rnbqkb1r/pppp1ppp/4pn2/8/2PP4/8/PP2PPPP/RNBQKBNR w KQkq - 0 3', 'comment': ''}, {'previous_board': 'rnbqkb1r/pppp1ppp/4pn2/8/2PP4/8/PP2PPPP/RNBQKBNR w KQkq - 0 3', 'current_board': 'rnbqkb1r/pppp1ppp/4pn2/8/2PP4/2N5/PP2PPPP/R1BQKBNR b KQkq - 1 3', 'comment': ''}, {'previous_board': 'rnbqkb1r/pppp1ppp/4pn2/8/2PP4/2N5/PP2PPPP/R1BQKBNR b KQkq - 1 3', 'current_board': 'rnbqkb1r/p1pp1ppp/1p2pn2/8/2PP4/2N5/PP2PPPP/R1BQKBNR w KQkq - 0 4', 'comment': ''}, {'previous_board': 'rnbqkb1r/p1pp1ppp/1p2pn2/8/2PP4/2N5/PP2PPPP/R1BQKBNR w KQkq - 0 4', 'current_board': 'rnbqkb1r/p1pp1ppp/1p2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R b KQkq - 1 4', 'comment': ''}, {'previous_board': 'rnbqkb1r/p1pp1ppp/1p2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R b KQkq - 1 4', 'current_board': 'rn1qkb1r/p1pp1ppp/bp2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R w KQkq - 2 5', 'comment': "Although this move is part of a book opening, I don't understand what it tries to achieve. The bishop would probably have to move back to b7 anyway, so isn't that like loosing a tempo?"}, {'previous_board': 'rn1qkb1r/p1pp1ppp/bp2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R w KQkq - 2 5', 'current_board': 'rn1qkb1r/p1pp1ppp/bp2pn2/8/2PPP3/2N2N2/PP3PPP/R1BQKB1R b KQkq - 0 5', 'comment': ''}, {'previous_board': 'rn1qkb1r/p1pp1ppp/bp2pn2/8/2PPP3/2N2N2/PP3PPP/R1BQKB1R b KQkq - 0 5', 'current_board': 'rn1qk2r/p1pp1ppp/bp2pn2/8/1bPPP3/2N2N2/PP3PPP/R1BQKB1R w KQkq - 1 6', 'comment': ''}, {'previous_board': 'rn1qk2r/p1pp1ppp/bp2pn2/8/1bPPP3/2N2N2/PP3PPP/R1BQKB1R w KQkq - 1 6', 'current_board': 'rn1qk2r/p1pp1ppp/bp2pn2/8/1bPPP3/2NB1N2/PP3PPP/R1BQK2R b KQkq - 2 6', 'comment': ''}, {'previous_board': 'rn1qk2r/p1pp1ppp/bp2pn2/8/1bPPP3/2NB1N2/PP3PPP/R1BQK2R b KQkq - 2 6', 'current_board': 'rn1qk2r/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PP3PPP/R1BQK2R w KQkq - 3 7', 'comment': ''}, {'previous_board': 'rn1qk2r/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PP3PPP/R1BQK2R w KQkq - 3 7', 'current_board': 'rn1qk2r/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B1K2R b KQkq - 4 7', 'comment': ''}, {'previous_board': 'rn1qk2r/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B1K2R b KQkq - 4 7', 'current_board': 'rn1q1rk1/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B1K2R w KQ - 5 8', 'comment': ''}, {'previous_board': 'rn1q1rk1/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B1K2R w KQ - 5 8', 'current_board': 'rn1q1rk1/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B2RK1 b - - 6 8', 'comment': ''}, {'previous_board': 'rn1q1rk1/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B2RK1 b - - 6 8', 'current_board': 'rn1q1rk1/pbpp1ppp/1p2p3/8/1bPPP1n1/2NB1N2/PPQ2PPP/R1B2RK1 w - - 7 9', 'comment': 'huh? what does this achieve? the N will have to go away anyway after h3.'}, {'previous_board': 'rn1q1rk1/pbpp1ppp/1p2p3/8/1bPPP1n1/2NB1N2/PPQ2PPP/R1B2RK1 w - - 7 9', 'current_board': 'rn1q1rk1/pbpp1ppp/1p2p3/6B1/1bPPP1n1/2NB1N2/PPQ2PPP/R4RK1 b - - 8 9', 'comment': "weakens g6 for black. the h7 pawn is already potentially attacked by white's B."}, {'previous_board': 'rn1q1rk1/pbpp1ppp/1p2p3/6B1/1bPPP1n1/2NB1N2/PPQ2PPP/R4RK1 b - - 8 9', 'current_board': 'rn1q1rk1/pbpp2pp/1p2pp2/6B1/1bPPP1n1/2NB1N2/PPQ2PPP/R4RK1 w - - 0 10', 'comment': ''}, {'previous_board': 'rn1q1rk1/pbpp2pp/1p2pp2/6B1/1bPPP1n1/2NB1N2/PPQ2PPP/R4RK1 w - - 0 10', 'current_board': 'rn1q1rk1/pbpp2pp/1p2pp2/8/1bPPP1nB/2NB1N2/PPQ2PPP/R4RK1 b - - 1 10', 'comment': 'other option was Bd2, but this is probably better. now white can do a number of interesting things, like e5'}, {'previous_board': 'rn1q1rk1/pbpp2pp/1p2pp2/8/1bPPP1nB/2NB1N2/PPQ2PPP/R4RK1 b - - 1 10', 'current_board': 'rn1q1rk1/pb1p2pp/1p2pp2/2p5/1bPPP1nB/2NB1N2/PPQ2PPP/R4RK1 w - - 0 11', 'comment': "good move. aims at breaking up white's pawn center."}, {'previous_board': 'rn1q1rk1/pb1p2pp/1p2pp2/2p5/1bPPP1nB/2NB1N2/PPQ2PPP/R4RK1 w - - 0 11', 'current_board': 'rn1q1rk1/pb1p2pp/1p2pp2/2p1P3/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 b - - 0 11', 'comment': "had to think a lot for this move. still unsure whether this was the best option. Other options were d5, a3 and h3. The ones I had to decide between in the end were e5 and d5. Both look good for white, but e5 has various very tactical lines. d5 locks the position, and the game develops slower. i think that the advantage is more sure with d5, but would be slow to convert into anything tangible. it would most probably be followed by d6, and exchange of the bishop for knight by black on c3. With e5, black's best reply seems to be cxd4. Bxf3 is also good. After Bxf3, white's pawns double, exposing the king on an open g file. After cxd4, white could play exf6 or Bxh7, both of which look good. Probably moving the c knight at some point would be a good idea, to avoid black exchaninging it for a useless bishop."}, {'previous_board': 'rn1q1rk1/pb1p2pp/1p2pp2/2p1P3/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 b - - 0 11', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pp2/2p1P3/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 w - - 1 12', 'comment': "interesting move. i did not expect it. prevents white from taking on h7 with check. however, i think that it is a 'slow' move, and black needed a 'fast' move at this time. now white can simply play exf6, and black would be forced to play Nxf6 or gxf6 (otherwise white wins the black Q). Nxf6 definately looks the better of the two. After that white can decide about what to do with black's threat of cxd4. Options would include Ne4, Ne5, a3, Bxh7 etc.."}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pp2/2p1P3/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 w - - 1 12', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pP2/2p5/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 b - - 0 12', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pP2/2p5/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 b - - 0 12', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pn2/2p5/1bPP3B/2NB1N2/PPQ2PPP/R4RK1 w - - 0 13', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pn2/2p5/1bPP3B/2NB1N2/PPQ2PPP/R4RK1 w - - 0 13', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pn2/2p5/1bPPN2B/3B1N2/PPQ2PPP/R4RK1 b - - 1 13', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pn2/2p5/1bPPN2B/3B1N2/PPQ2PPP/R4RK1 b - - 1 13', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pn2/8/1bPpN2B/3B1N2/PPQ2PPP/R4RK1 w - - 0 14', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pn2/8/1bPpN2B/3B1N2/PPQ2PPP/R4RK1 w - - 0 14', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pN2/8/1bPp3B/3B1N2/PPQ2PPP/R4RK1 b - - 0 14', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pN2/8/1bPp3B/3B1N2/PPQ2PPP/R4RK1 b - - 0 14', 'current_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPp3B/3B1N2/PPQ2PPP/R4RK1 w - - 0 15', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPp3B/3B1N2/PPQ2PPP/R4RK1 w - - 0 15', 'current_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPN3B/3B4/PPQ2PPP/R4RK1 b - - 0 15', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPN3B/3B4/PPQ2PPP/R4RK1 b - - 0 15', 'current_board': 'rn3r1k/pbqp3p/1p2pp2/8/1bPN3B/3B4/PPQ2PPP/R4RK1 w - - 1 16', 'comment': "the space around black's king has opened up. however, black now also has open files to place his rooks on to attack white's king in conjunction with his bishops. however black's N is still undeveloped."}, {'previous_board': 'rn3r1k/pbqp3p/1p2pp2/8/1bPN3B/3B4/PPQ2PPP/R4RK1 w - - 1 16', 'current_board': 'rn3r1k/pbqp3p/1p2pp2/8/1bPN4/3B2B1/PPQ2PPP/R4RK1 b - - 2 16', 'comment': ''}, {'previous_board': 'rn3r1k/pbqp3p/1p2pp2/8/1bPN4/3B2B1/PPQ2PPP/R4RK1 b - - 2 16', 'current_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPN4/3B2B1/PPQ2PPP/R4RK1 w - - 3 17', 'comment': 'maybe Qc5 would have been better'}, {'previous_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPN4/3B2B1/PPQ2PPP/R4RK1 w - - 3 17', 'current_board': 'rn1q1r1k/pb1p3p/1p2pp2/1N6/1bP5/3B2B1/PPQ2PPP/R4RK1 b - - 4 17', 'comment': "with the aim of lodging in at d6. black should next play a move which blocks white's black B, or opens space around his rook, otherwise white can win the exchange by playing Nc7. 17..f5 looks to be the best for black. This sequence of moves leaves white's white B weaker."}, {'previous_board': 'rn1q1r1k/pb1p3p/1p2pp2/1N6/1bP5/3B2B1/PPQ2PPP/R4RK1 b - - 4 17', 'current_board': 'rn1q1r1k/1b1p3p/pp2pp2/1N6/1bP5/3B2B1/PPQ2PPP/R4RK1 w - - 0 18', 'comment': 'opens space around rook, and scares the N off'}, {'previous_board': 'rn1q1r1k/1b1p3p/pp2pp2/1N6/1bP5/3B2B1/PPQ2PPP/R4RK1 w - - 0 18', 'current_board': 'rn1q1r1k/1b1p3p/pp1Npp2/8/1bP5/3B2B1/PPQ2PPP/R4RK1 b - - 1 18', 'comment': ''}, {'previous_board': 'rn1q1r1k/1b1p3p/pp1Npp2/8/1bP5/3B2B1/PPQ2PPP/R4RK1 b - - 1 18', 'current_board': 'rn1q1r1k/1b1p3p/pp1bpp2/8/2P5/3B2B1/PPQ2PPP/R4RK1 w - - 0 19', 'comment': "Black exchanges his weak black B for white's N which would have cramped things for black had it stayed on d6. However, white is now left with 2 bishops, which could work well to dominate the board"}, {'previous_board': 'rn1q1r1k/1b1p3p/pp1bpp2/8/2P5/3B2B1/PPQ2PPP/R4RK1 w - - 0 19', 'current_board': 'rn1q1r1k/1b1p3p/pp1Bpp2/8/2P5/3B4/PPQ2PPP/R4RK1 b - - 0 19', 'comment': ''}, {'previous_board': 'rn1q1r1k/1b1p3p/pp1Bpp2/8/2P5/3B4/PPQ2PPP/R4RK1 b - - 0 19', 'current_board': 'rn1q2rk/1b1p3p/pp1Bpp2/8/2P5/3B4/PPQ2PPP/R4RK1 w - - 1 20', 'comment': ''}, {'previous_board': 'rn1q2rk/1b1p3p/pp1Bpp2/8/2P5/3B4/PPQ2PPP/R4RK1 w - - 1 20', 'current_board': 'rn1q2rk/1b1p3p/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/R4RK1 b - - 0 20', 'comment': ''}, {'previous_board': 'rn1q2rk/1b1p3p/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/R4RK1 b - - 0 20', 'current_board': 'rn1q3k/1b1p2rp/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/R4RK1 w - - 1 21', 'comment': "to protect Bxh7. But now black cannot play f5 (which would have reduced white's white B's mobility and strengthened the f-pawn) since black's rook and king are on the same diagonal."}, {'previous_board': 'rn1q3k/1b1p2rp/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/R4RK1 w - - 1 21', 'current_board': 'rn1q3k/1b1p2rp/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/3R1RK1 b - - 2 21', 'comment': 'rook to semi-open file.'}, {'previous_board': 'rn1q3k/1b1p2rp/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/3R1RK1 b - - 2 21', 'current_board': 'r2q3k/1b1p2rp/ppnBpp2/8/2P5/3B1P2/PPQ3PP/3R1RK1 w - - 3 22', 'comment': 'black develops N at last!'}, {'previous_board': 'r2q3k/1b1p2rp/ppnBpp2/8/2P5/3B1P2/PPQ3PP/3R1RK1 w - - 3 22', 'current_board': 'r2q3k/1b1p2rp/ppnBpp2/8/2P1B3/5P2/PPQ3PP/3R1RK1 b - - 4 22', 'comment': "pins N. opens up space for R to exert influence. Cheekily invites f5 from black. Black's camp is now quite cramped. The N can't move, the Q has few squares to go to, and must protect f6. Black has to think of a way to liberate himself, and white has to think of a way to use the space he has to attack."}, {'previous_board': 'r2q3k/1b1p2rp/ppnBpp2/8/2P1B3/5P2/PPQ3PP/3R1RK1 b - - 4 22', 'current_board': '2rq3k/1b1p2rp/ppnBpp2/8/2P1B3/5P2/PPQ3PP/3R1RK1 w - - 5 23', 'comment': ''}, {'previous_board': '2rq3k/1b1p2rp/ppnBpp2/8/2P1B3/5P2/PPQ3PP/3R1RK1 w - - 5 23', 'current_board': '2rq3k/1b1p2rp/ppnBpp2/8/2P1B3/1P3P2/P1Q3PP/3R1RK1 b - - 0 23', 'comment': "protects the c-pawn against a potential Na5. The 2 general concepts in my mind at this time were to weaken the black pawns by moving my f-pawn up the board. This threat is quite real and near, so black should move his king and play f5 as soon as possible. If white had played f4 immediately, then 23..Na5 24.b3 Bxe4 25.Qxe4 f5, and black is now less cramped, and white hasn't succeeded in weakening black's center pawns as he would have wished. The other thing I wanted to do was to double up on the d-file, and exert pressure on black's backward d-pawn."}, {'previous_board': '2rq3k/1b1p2rp/ppnBpp2/8/2P1B3/1P3P2/P1Q3PP/3R1RK1 b - - 0 23', 'current_board': '2rq3k/1b1p2rp/pp1Bpp2/n7/2P1B3/1P3P2/P1Q3PP/3R1RK1 w - - 1 24', 'comment': "Black most probably played this to make his position more 'fluid' - to free his pieces. However the N has no squares where it is currently at. Black would be aiming to exchange bishops, and then play the N to b7, or maybe even c6."}, {'previous_board': '2rq3k/1b1p2rp/pp1Bpp2/n7/2P1B3/1P3P2/P1Q3PP/3R1RK1 w - - 1 24', 'current_board': '2rq3k/1b1p2rp/pp1Bpp2/n7/2P1B3/1P3P2/P1Q2RPP/3R2K1 b - - 2 24', 'comment': 'With the aim of doubling on the d-file. Once the rooks are doubled, white can move the B from d6, and bring it to the long diagonal where it would be powerful. Also, the Q would be protecting both, d7 and f6, which could cause black problems.'}, {'previous_board': '2rq3k/1b1p2rp/pp1Bpp2/n7/2P1B3/1P3P2/P1Q2RPP/3R2K1 b - - 2 24', 'current_board': '2rq3k/3p2rp/ppbBpp2/n7/2P1B3/1P3P2/P1Q2RPP/3R2K1 w - - 3 25', 'comment': 'makes room for the N. Alternatively black could have played 24..Bxe4'}, {'previous_board': '2rq3k/3p2rp/ppbBpp2/n7/2P1B3/1P3P2/P1Q2RPP/3R2K1 w - - 3 25', 'current_board': '2rq3k/3p2rp/ppbBpp2/n7/2P1B3/1P3P2/P1QR2PP/3R2K1 b - - 4 25', 'comment': ''}, {'previous_board': '2rq3k/3p2rp/ppbBpp2/n7/2P1B3/1P3P2/P1QR2PP/3R2K1 b - - 4 25', 'current_board': '2rq3k/1n1p2rp/ppbBpp2/8/2P1B3/1P3P2/P1QR2PP/3R2K1 w - - 5 26', 'comment': "At this point I had to make a few important decisions. First of all I had to decide whether I wanted black to take my B. Nxd6 would leave me without my dark bishop. In this position, the dark bishop appears to be quite powerful. Placed on the a1-h8 diagonal, it could cause black problems. However if I moved the bishop, after a few moves black could advance the d-pawn (but if Nxd6, then Rxd6 keeps the d-pawn back, and weak). And there were also 2 options if I decided to move my B - I could either bring it to the b2 square through a3, or I could take it to f4, and then play Bh6 at some point. So at this junction, I was considering 3 moves: Ba3, Bf4 and a move in which I wouldn't move my B, probably Qb2"}, {'previous_board': '2rq3k/1n1p2rp/ppbBpp2/8/2P1B3/1P3P2/P1QR2PP/3R2K1 w - - 5 26', 'current_board': '2rq3k/1n1p2rp/ppb1pp2/8/2P1B3/BP3P2/P1QR2PP/3R2K1 b - - 6 26', 'comment': "This was a very difficult decision for me. I didn't play Qb2 because e5 by black didn't look good. I also didn't want to exchange much material right now, because I fealt that the pressure was on black, and exchanges would let some of the steam off. I didn't play Bf4 because it didn't seem to do much. Now black may be able to play d5 at some point, which would give him space, and strengthen his d-pawn. However white's bishop would be strong at b2."}, {'previous_board': '2rq3k/1n1p2rp/ppb1pp2/8/2P1B3/BP3P2/P1QR2PP/3R2K1 b - - 6 26', 'current_board': '2rq3k/1n4rp/ppb1pp2/3p4/2P1B3/BP3P2/P1QR2PP/3R2K1 w - - 0 27', 'comment': ''}, {'previous_board': '2rq3k/1n4rp/ppb1pp2/3p4/2P1B3/BP3P2/P1QR2PP/3R2K1 w - - 0 27', 'current_board': '2rq3k/1n4rp/ppb1pp2/3P4/4B3/BP3P2/P1QR2PP/3R2K1 b - - 0 27', 'comment': ''}, {'previous_board': '2rq3k/1n4rp/ppb1pp2/3P4/4B3/BP3P2/P1QR2PP/3R2K1 b - - 0 27', 'current_board': '2rq3k/1n4rp/pp2pp2/3b4/4B3/BP3P2/P1QR2PP/3R2K1 w - - 0 28', 'comment': ''}, {'previous_board': '2rq3k/1n4rp/pp2pp2/3b4/4B3/BP3P2/P1QR2PP/3R2K1 w - - 0 28', 'current_board': '2rq3k/1n4rp/pp2pp2/3b4/4B3/BP3P2/P2R2PP/1Q1R2K1 b - - 1 28', 'comment': ''}, {'previous_board': '2rq3k/1n4rp/pp2pp2/3b4/4B3/BP3P2/P2R2PP/1Q1R2K1 b - - 1 28', 'current_board': '2rq3k/1n1r3p/pp2pp2/3b4/4B3/BP3P2/P2R2PP/1Q1R2K1 w - - 2 29', 'comment': ''}, {'previous_board': '2rq3k/1n1r3p/pp2pp2/3b4/4B3/BP3P2/P2R2PP/1Q1R2K1 w - - 2 29', 'current_board': '2rq3k/1n1r3p/pp2pp2/3b4/4B3/1P3P2/PB1R2PP/1Q1R2K1 b - - 3 29', 'comment': ''}, {'previous_board': '2rq3k/1n1r3p/pp2pp2/3b4/4B3/1P3P2/PB1R2PP/1Q1R2K1 b - - 3 29', 'current_board': '3q3k/1n1r3p/pp2pp2/2rb4/4B3/1P3P2/PB1R2PP/1Q1R2K1 w - - 4 30', 'comment': ''}, {'previous_board': '3q3k/1n1r3p/pp2pp2/2rb4/4B3/1P3P2/PB1R2PP/1Q1R2K1 w - - 4 30', 'current_board': '3q3k/1n1r3p/pp2pp2/2rb4/4B3/1P1Q1P2/PB1R2PP/3R2K1 b - - 5 30', 'comment': 'Attacks a6, and threatens Qe3. After Qe3 white could play Bxd5, with the white Q eventually taking on e6, and leaving the black king in real danger. Maybe it was a bit premature for black to resign - the position however, does favour white quite heavily.'}])
        self.assertEqual(parsed_response.rows(), expected.rows())

    @mock.patch('crawler.main.parse_response_text')
    @mock.patch('crawler.main.os.path.exists', return_value=True)
    @mock.patch('crawler.main.requests.get')
    def test_save_game_skips_if_fetched(self, mock_get: mock.Mock, mock_exists: mock.Mock, mock_response_text: mock.Mock):
        crawler.main.save_game('', ('train', 1), True)
        mock_get.assert_not_called()
        mock_exists.assert_called_with(f"train/1.parquet")

    @mock.patch('crawler.main.parse_response_text')
    @mock.patch('crawler.main.os.path.exists', return_value=True)
    @mock.patch('crawler.main.requests.get')
    def test_save_game_doesnt_skip_if_flag_is_not_set(self, mock_get: mock.Mock, mock_exists: mock.Mock, mock_response_text: mock.Mock):
        mock_get.return_value.status_code = 200
        mock_response_text.save_parquet()
        crawler.main.save_game('', ('train', 1), False)
        mock_get.assert_called_with(f"https://gameknot.com/annotate.pl?id=1")
        mock_exists.assert_not_called()

    @mock.patch('crawler.main.parse_response_text')
    @mock.patch('crawler.main.os.path.exists', return_value=True)
    @mock.patch('crawler.main.requests.get')
    def test_save_game_raises_if_request_fails(self, mock_get: mock.Mock, mock_exists: mock.Mock, mock_response_text: mock.Mock):
        mock_get.return_value.status_code = 400
        mock_response_text.save_parquet()
        with self.assertRaises(Exception):
            crawler.main.save_game('', ('train', 1), False)

    @mock.patch('crawler.main.save_game')
    @mock.patch('crawler.main.open')
    @mock.patch('crawler.main.pickle.load')
    def test_crawl_unit_test(self, mock_load: mock.Mock, mock_open: mock.Mock, mock_save_game: mock.Mock):
        def pickle_load(s: str):
            if s == "train_links.p":
                return [(None, 'gm=1')]
            if s == "test_links.p":
                return [(None, 'gm=3')]
            if s == "valid_links.p":
                return [(None, 'gm=2')]
            raise Exception("invalid call")

        mock_open.side_effect = (lambda x, y: x)
        mock_load.side_effect = pickle_load

        crawler.main.crawl('', '')
        mock_save_game.assert_has_calls([
            mock.call('', ('train', 1), False),
            mock.call('', ('valid', 2), False),
            mock.call('', ('test', 3), False)
        ],
        any_order=True)

    @mock.patch('crawler.main.pl.DataFrame.write_parquet', autospec=True)
    @mock.patch('crawler.main.requests.get')
    @mock.patch('crawler.main.os.path.exists', return_value=True)
    @mock.patch('crawler.main.open')
    @mock.patch('crawler.main.pickle.load')
    def test_crawl_integration_test(self,
        mock_load: mock.Mock,
        mock_open: mock.Mock,
        mock_exists: mock.Mock,
        mock_get: mock.Mock,
        mock_write_parquet: mock.Mock
    ) -> None:
        def pickle_load(s: str):
            if s == "train_links.p":
                return [(None, 'gm=1')]
            else:
                return []
        mock_open.side_effect = (lambda x, y: x)
        mock_load.side_effect = pickle_load
        mock_get.return_value.status_code = 200
        mock_get.return_value.text = '<!DOCTYPE HTML>\n<HTML lang="en"><HEAD><TITLE>GameKnot: chess game annotation #119</TITLE>\n<meta charset="UTF-8">\n<!-- GameKnot Chess v231026 -->\n<meta name="viewport" content="width=device-width">\n\n\n<link rel="stylesheet" type="text/css" href="/css/main0.231026.css">\n<link rel="shortcut icon" href="/img/gk32x32.png">\n<link rel="icon" sizes="192x192" href="/img/gk-icon-192x192.png" type="image/png">\n<link rel="icon" sizes="128x128" href="/img/gk-icon-128x128.png" type="image/png">\n<link rel="apple-touch-icon" sizes="180x180" href="/img/gk-icon-180x180.png">\n<link rel="manifest" href="/manifest.231026.json">\n<meta http-equiv="X-UA-Compatible" content="IE=edge">\n<meta name="apple-mobile-web-app-capable" content="yes">\n<meta name="apple-mobile-web-app-status-bar-style" content="default">\n<meta name="mobile-web-app-capable" content="yes">\n<meta name="pinterest" content="nohover">\n<meta name="format-detection" content="telephone=no,date=no">\n<script type="text/javascript" src="/js/common.231026.js"></script>\n\n<script type="text/javascript">\nif (screen.width<1000)\n{\n    var e = document.querySelector("meta[name=viewport]");\n    if (e) e.parentNode.removeChild(e);\n    e = document.createElement("meta");\n    e.setAttribute("name", "viewport");\n    e.setAttribute("content", "width=1000");\n    document.head.appendChild(e);\n}\n</script>\n\n\n</HEAD>\n<BODY class=gk_pop>\n<script>\nfunction ipad_workaround()\n{\n    var id = \'_div_ipad_workaround\';\n    var o = gk_get_el(id);\n    if (o) return;\n\n    var t = 0;\n    try { t = /CriOS\\/85\\.0/.test(navigator.userAgent); } catch(e) {}\n    if (!t) return;\n    \n    if (!window.visualViewport || window.visualViewport.height<900 && window.visualViewport.width<900) return;\n    \n    var o = document.createElement(\'div\');\n    o.id = id;\n    o.style.height = \'110px\';\n\n    o.innerHTML = \'&nbsp;\';\n\n    document.body.insertBefore( o, document.body.firstChild );\n}\nsetTimeout( ipad_workaround, 10 );\n</script>\n\n\n<!-- script type="text/javascript" src="/js/common_err.js"></script -->\n<script src="/js/chess-board.021420.js"></script>\n<script src="/js/annotate.010721.js"></script>\n<script src="/js/pgn.061819.js"></script>\n<script src="/js/export_web.062021.js"></script>\n<script src="/js/chess-board-ui.js?030809"></script>\n<script src="/js/rate-stars.js?072114"></script>\n<script src="/js/spellcheck.js?041113"></script>\n\n<div id="anno">Loading... (<a href="/pg/help_cache.htm" target="_blank" onClick="location.reload(true);">help?</a>)</div>\n\n<script type="text/javascript"><!--\n\nb_edit = 0;\n\ngame_error_msg = \'\';\ngame_id = 119;\ngame_modified = 0;\ngame_public = 1;\ngame_bd = 5332951;\ngame_title = decode_str(\'Challenge from bittersweet_ballad\');\ngame_movelist = \'d2d4-g8f6-c2c4-e7e6-b1c3-b7b6-g1f3-c8a6-e2e4-f8b4-f1d3-a6b7-d1c2-e8g8-e1g1-f6g4-c1g5-f7f6-g5h4-c7c5-e4e5-g8h8-e5f6-g4f6-c3e4-c5d4-e4f6-g7f6-f3d4-d8c7-h4g3-c7d8-d4b5-a7a6-b5d6-b4d6-g3d6-f8g8-f2f3-g8g7-a1d1-b8c6-d3e4-a8c8-b2b3-c6a5-f1f2-b7c6-f2d2-a5b7-d6a3-d7d5-c4d5-c6d5-c2b1-g7d7-a3b2-c8c5-b1d3-\';\ngame_result = 1;\ngame_player_w = decode_str(\'bittersweet_ballad\');\ngame_player_b = decode_str(\'aqeel\');\ngame_rating_w = decode_str(\'1855\');\ngame_rating_b = decode_str(\'1893\');\ngame_cur_note = decode_str(\'\');\ngame_time = decode_str(\'14 days per move\');\ngame_started = decode_str(\'23-Jun-06\');\ngame_ended = decode_str(\'19-Aug-06\');\ngame_notes = [ "","I%20annotated%20this%20game%20as%20it%20proceeded.%20The%20annotations%20therefore%20don%27t%20have%20any%20retrospective%20analysis%2c%20and%20are%20only%20the%20thoughts%20going%20on%20in%20my%20mind%20while%20I%20was%20playing.","","","","","","","Although%20this%20move%20is%20part%20of%20a%20book%20opening%2c%20I%20don%27t%20understand%20what%20it%20tries%20to%20achieve.%20The%20bishop%20would%20probably%20have%20to%20move%20back%20to%20b7%20anyway%2c%20so%20isn%27t%20that%20like%20loosing%20a%20tempo%3f","","","","","","","","huh%3f%20what%20does%20this%20achieve%3f%20the%20N%20will%20have%20to%20go%20away%20anyway%20after%20h3.","weakens%20g6%20for%20black.%20the%20h7%20pawn%20is%20already%20potentially%20attacked%20by%20white%27s%20B.","","other%20option%20was%20Bd2%2c%20but%20this%20is%20probably%20better.%20now%20white%20can%20do%20a%20number%20of%20interesting%20things%2c%20like%20e5","good%20move.%20aims%20at%20breaking%20up%20white%27s%20pawn%20center.","had%20to%20think%20a%20lot%20for%20this%20move.%20still%20unsure%20whether%20this%20was%20the%20best%20option.%20Other%20options%20were%20d5%2c%20a3%20and%20h3.%20The%20ones%20I%20had%20to%20decide%20between%20in%20the%20end%20were%20e5%20and%20d5.%20Both%20look%20good%20for%20white%2c%20but%20e5%20has%20various%20very%20tactical%20lines.%20d5%20locks%20the%20position%2c%20and%20the%20game%20develops%20slower.%20i%20think%20that%20the%20advantage%20is%20more%20sure%20with%20d5%2c%20but%20would%20be%20slow%20to%20convert%20into%20anything%20tangible.%20it%20would%20most%20probably%20be%20followed%20by%20d6%2c%20and%20exchange%20of%20the%20bishop%20for%20knight%20by%20black%20on%20c3.%20With%20e5%2c%20black%27s%20best%20reply%20seems%20to%20be%20cxd4.%20Bxf3%20is%20also%20good.%20After%20Bxf3%2c%20white%27s%20pawns%20double%2c%20exposing%20the%20king%20on%20an%20open%20g%20file.%20After%20cxd4%2c%20white%20could%20play%20exf6%20or%20Bxh7%2c%20both%20of%20which%20look%20good.%20Probably%20moving%20the%20c%20knight%20at%20some%20point%20would%20be%20a%20good%20idea%2c%20to%20avoid%20black%20exchaninging%20it%20for%20a%20useless%20bishop.","interesting%20move.%20i%20did%20not%20expect%20it.%20prevents%20white%20from%20taking%20on%20h7%20with%20check.%20however%2c%20i%20think%20that%20it%20is%20a%20%27slow%27%20move%2c%20and%20black%20needed%20a%20%27fast%27%20move%20at%20this%20time.%20now%20white%20can%20simply%20play%20exf6%2c%20and%20black%20would%20be%20forced%20to%20play%20Nxf6%20or%20gxf6%20(otherwise%20white%20wins%20the%20black%20Q).%20Nxf6%20definately%20looks%20the%20better%20of%20the%20two.%20After%20that%20white%20can%20decide%20about%20what%20to%20do%20with%20black%27s%20threat%20of%20cxd4.%20Options%20would%20include%20Ne4%2c%20Ne5%2c%20a3%2c%20Bxh7%20etc..","","","","","","","","the%20space%20around%20black%27s%20king%20has%20opened%20up.%20however%2c%20black%20now%20also%20has%20open%20files%20to%20place%20his%20rooks%20on%20to%20attack%20white%27s%20king%20in%20conjunction%20with%20his%20bishops.%20however%20black%27s%20N%20is%20still%20undeveloped.","","maybe%20Qc5%20would%20have%20been%20better","with%20the%20aim%20of%20lodging%20in%20at%20d6.%20black%20should%20next%20play%20a%20move%20which%20blocks%20white%27s%20black%20B%2c%20or%20opens%20space%20around%20his%20rook%2c%20otherwise%20white%20can%20win%20the%20exchange%20by%20playing%20Nc7.%2017..f5%20looks%20to%20be%20the%20best%20for%20black.%20This%20sequence%20of%20moves%20leaves%20white%27s%20white%20B%20weaker.","opens%20space%20around%20rook%2c%20and%20scares%20the%20N%20off","","Black%20exchanges%20his%20weak%20black%20B%20for%20white%27s%20N%20which%20would%20have%20cramped%20things%20for%20black%20had%20it%20stayed%20on%20d6.%20However%2c%20white%20is%20now%20left%20with%202%20bishops%2c%20which%20could%20work%20well%20to%20dominate%20the%20board","","","","to%20protect%20Bxh7.%20But%20now%20black%20cannot%20play%20f5%20(which%20would%20have%20reduced%20white%27s%20white%20B%27s%20mobility%20and%20strengthened%20the%20f-pawn)%20since%20black%27s%20rook%20and%20king%20are%20on%20the%20same%20diagonal.","rook%20to%20semi-open%20file.","black%20develops%20N%20at%20last!","pins%20N.%20opens%20up%20space%20for%20R%20to%20exert%20influence.%20Cheekily%20invites%20f5%20from%20black.%20Black%27s%20camp%20is%20now%20quite%20cramped.%20The%20N%20can%27t%20move%2c%20the%20Q%20has%20few%20squares%20to%20go%20to%2c%20and%20must%20protect%20f6.%20Black%20has%20to%20think%20of%20a%20way%20to%20liberate%20himself%2c%20and%20white%20has%20to%20think%20of%20a%20way%20to%20use%20the%20space%20he%20has%20to%20attack.","","protects%20the%20c-pawn%20against%20a%20potential%20Na5.%20The%202%20general%20concepts%20in%20my%20mind%20at%20this%20time%20were%20to%20weaken%20the%20black%20pawns%20by%20moving%20my%20f-pawn%20up%20the%20board.%20This%20threat%20is%20quite%20real%20and%20near%2c%20so%20black%20should%20move%20his%20king%20and%20play%20f5%20as%20soon%20as%20possible.%20If%20white%20had%20played%20f4%20immediately%2c%20then%2023..Na5%2024.b3%20Bxe4%2025.Qxe4%20f5%2c%20and%20black%20is%20now%20less%20cramped%2c%20and%20white%20hasn%27t%20succeeded%20in%20weakening%20black%27s%20center%20pawns%20as%20he%20would%20have%20wished.%20The%20other%20thing%20I%20wanted%20to%20do%20was%20to%20double%20up%20on%20the%20d-file%2c%20and%20exert%20pressure%20on%20black%27s%20backward%20d-pawn.","Black%20most%20probably%20played%20this%20to%20make%20his%20position%20more%20%27fluid%27%20-%20to%20free%20his%20pieces.%20However%20the%20N%20has%20no%20squares%20where%20it%20is%20currently%20at.%20Black%20would%20be%20aiming%20to%20exchange%20bishops%2c%20and%20then%20play%20the%20N%20to%20b7%2c%20or%20maybe%20even%20c6.","With%20the%20aim%20of%20doubling%20on%20the%20d-file.%20Once%20the%20rooks%20are%20doubled%2c%20white%20can%20move%20the%20B%20from%20d6%2c%20and%20bring%20it%20to%20the%20long%20diagonal%20where%20it%20would%20be%20powerful.%20Also%2c%20the%20Q%20would%20be%20protecting%20both%2c%20d7%20and%20f6%2c%20which%20could%20cause%20black%20problems.","makes%20room%20for%20the%20N.%20Alternatively%20black%20could%20have%20played%2024..Bxe4","","At%20this%20point%20I%20had%20to%20make%20a%20few%20important%20decisions.%20First%20of%20all%20I%20had%20to%20decide%20whether%20I%20wanted%20black%20to%20take%20my%20B.%20Nxd6%20would%20leave%20me%20without%20my%20dark%20bishop.%20In%20this%20position%2c%20the%20dark%20bishop%20appears%20to%20be%20quite%20powerful.%20Placed%20on%20the%20a1-h8%20diagonal%2c%20it%20could%20cause%20black%20problems.%20However%20if%20I%20moved%20the%20bishop%2c%20after%20a%20few%20moves%20black%20could%20advance%20the%20d-pawn%20(but%20if%20Nxd6%2c%20then%20Rxd6%20keeps%20the%20d-pawn%20back%2c%20and%20weak).%20And%20there%20were%20also%202%20options%20if%20I%20decided%20to%20move%20my%20B%20-%20I%20could%20either%20bring%20it%20to%20the%20b2%20square%20through%20a3%2c%20or%20I%20could%20take%20it%20to%20f4%2c%20and%20then%20play%20Bh6%20at%20some%20point.%20So%20at%20this%20junction%2c%20I%20was%20considering%203%20moves%3a%20Ba3%2c%20Bf4%20and%20a%20move%20in%20which%20I%20wouldn%27t%20move%20my%20B%2c%20probably%20Qb2","This%20was%20a%20very%20difficult%20decision%20for%20me.%20I%20didn%27t%20play%20Qb2%20because%20e5%20by%20black%20didn%27t%20look%20good.%20I%20also%20didn%27t%20want%20to%20exchange%20much%20material%20right%20now%2c%20because%20I%20fealt%20that%20the%20pressure%20was%20on%20black%2c%20and%20exchanges%20would%20let%20some%20of%20the%20steam%20off.%20I%20didn%27t%20play%20Bf4%20because%20it%20didn%27t%20seem%20to%20do%20much.%20Now%20black%20may%20be%20able%20to%20play%20d5%20at%20some%20point%2c%20which%20would%20give%20him%20space%2c%20and%20strengthen%20his%20d-pawn.%20However%20white%27s%20bishop%20would%20be%20strong%20at%20b2.","","","","","","","","Attacks%20a6%2c%20and%20threatens%20Qe3.%20After%20Qe3%20white%20could%20play%20Bxd5%2c%20with%20the%20white%20Q%20eventually%20taking%20on%20e6%2c%20and%20leaving%20the%20black%20king%20in%20real%20danger.%20Maybe%20it%20was%20a%20bit%20premature%20for%20black%20to%20resign%20-%20the%20position%20however%2c%20does%20favour%20white%20quite%20heavily." ];\n\nstar_rating = -1;\n\ninit_page( \'anno\', 0, 0 );\n\n// --></script>\n\n<script>\nfunction gk_lazyload_all()\n{\n    var all = document.querySelectorAll(\'[data-chess-diagram]\');\n    if (!all || !all.length) return;\n    if (!load_js(\'/js/chess-diagram.022621.js\')) render_all_chess_diagrams();\n}\nsetTimeout( gk_lazyload_all, 1 );\n</script>\n<script async src="https://www.googletagmanager.com/gtag/js?id=UA-261935-1"></script>\n<script>\nwindow.dataLayer = window.dataLayer || [];\nfunction gtag(){dataLayer.push(arguments);}\ngtag(\'js\', new Date());\ngtag(\'set\', {\'user_id\': \'0\'});\ngtag(\'config\',\'UA-261935-1\');\n</script>\n\n<script>\nconsole.log(\'--- Footer included (10/12/2021)\');\n</script>\n\n</BODY>\n</HTML>\n'
        expected = pl.DataFrame([{'previous_board': 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1', 'current_board': 'rnbqkbnr/pppppppp/8/8/3P4/8/PPP1PPPP/RNBQKBNR b KQkq - 0 1', 'comment': "I annotated this game as it proceeded. The annotations therefore don't have any retrospective analysis, and are only the thoughts going on in my mind while I was playing."}, {'previous_board': 'rnbqkbnr/pppppppp/8/8/3P4/8/PPP1PPPP/RNBQKBNR b KQkq - 0 1', 'current_board': 'rnbqkb1r/pppppppp/5n2/8/3P4/8/PPP1PPPP/RNBQKBNR w KQkq - 1 2', 'comment': ''}, {'previous_board': 'rnbqkb1r/pppppppp/5n2/8/3P4/8/PPP1PPPP/RNBQKBNR w KQkq - 1 2', 'current_board': 'rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR b KQkq - 0 2', 'comment': ''}, {'previous_board': 'rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR b KQkq - 0 2', 'current_board': 'rnbqkb1r/pppp1ppp/4pn2/8/2PP4/8/PP2PPPP/RNBQKBNR w KQkq - 0 3', 'comment': ''}, {'previous_board': 'rnbqkb1r/pppp1ppp/4pn2/8/2PP4/8/PP2PPPP/RNBQKBNR w KQkq - 0 3', 'current_board': 'rnbqkb1r/pppp1ppp/4pn2/8/2PP4/2N5/PP2PPPP/R1BQKBNR b KQkq - 1 3', 'comment': ''}, {'previous_board': 'rnbqkb1r/pppp1ppp/4pn2/8/2PP4/2N5/PP2PPPP/R1BQKBNR b KQkq - 1 3', 'current_board': 'rnbqkb1r/p1pp1ppp/1p2pn2/8/2PP4/2N5/PP2PPPP/R1BQKBNR w KQkq - 0 4', 'comment': ''}, {'previous_board': 'rnbqkb1r/p1pp1ppp/1p2pn2/8/2PP4/2N5/PP2PPPP/R1BQKBNR w KQkq - 0 4', 'current_board': 'rnbqkb1r/p1pp1ppp/1p2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R b KQkq - 1 4', 'comment': ''}, {'previous_board': 'rnbqkb1r/p1pp1ppp/1p2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R b KQkq - 1 4', 'current_board': 'rn1qkb1r/p1pp1ppp/bp2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R w KQkq - 2 5', 'comment': "Although this move is part of a book opening, I don't understand what it tries to achieve. The bishop would probably have to move back to b7 anyway, so isn't that like loosing a tempo?"}, {'previous_board': 'rn1qkb1r/p1pp1ppp/bp2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R w KQkq - 2 5', 'current_board': 'rn1qkb1r/p1pp1ppp/bp2pn2/8/2PPP3/2N2N2/PP3PPP/R1BQKB1R b KQkq - 0 5', 'comment': ''}, {'previous_board': 'rn1qkb1r/p1pp1ppp/bp2pn2/8/2PPP3/2N2N2/PP3PPP/R1BQKB1R b KQkq - 0 5', 'current_board': 'rn1qk2r/p1pp1ppp/bp2pn2/8/1bPPP3/2N2N2/PP3PPP/R1BQKB1R w KQkq - 1 6', 'comment': ''}, {'previous_board': 'rn1qk2r/p1pp1ppp/bp2pn2/8/1bPPP3/2N2N2/PP3PPP/R1BQKB1R w KQkq - 1 6', 'current_board': 'rn1qk2r/p1pp1ppp/bp2pn2/8/1bPPP3/2NB1N2/PP3PPP/R1BQK2R b KQkq - 2 6', 'comment': ''}, {'previous_board': 'rn1qk2r/p1pp1ppp/bp2pn2/8/1bPPP3/2NB1N2/PP3PPP/R1BQK2R b KQkq - 2 6', 'current_board': 'rn1qk2r/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PP3PPP/R1BQK2R w KQkq - 3 7', 'comment': ''}, {'previous_board': 'rn1qk2r/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PP3PPP/R1BQK2R w KQkq - 3 7', 'current_board': 'rn1qk2r/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B1K2R b KQkq - 4 7', 'comment': ''}, {'previous_board': 'rn1qk2r/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B1K2R b KQkq - 4 7', 'current_board': 'rn1q1rk1/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B1K2R w KQ - 5 8', 'comment': ''}, {'previous_board': 'rn1q1rk1/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B1K2R w KQ - 5 8', 'current_board': 'rn1q1rk1/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B2RK1 b - - 6 8', 'comment': ''}, {'previous_board': 'rn1q1rk1/pbpp1ppp/1p2pn2/8/1bPPP3/2NB1N2/PPQ2PPP/R1B2RK1 b - - 6 8', 'current_board': 'rn1q1rk1/pbpp1ppp/1p2p3/8/1bPPP1n1/2NB1N2/PPQ2PPP/R1B2RK1 w - - 7 9', 'comment': 'huh? what does this achieve? the N will have to go away anyway after h3.'}, {'previous_board': 'rn1q1rk1/pbpp1ppp/1p2p3/8/1bPPP1n1/2NB1N2/PPQ2PPP/R1B2RK1 w - - 7 9', 'current_board': 'rn1q1rk1/pbpp1ppp/1p2p3/6B1/1bPPP1n1/2NB1N2/PPQ2PPP/R4RK1 b - - 8 9', 'comment': "weakens g6 for black. the h7 pawn is already potentially attacked by white's B."}, {'previous_board': 'rn1q1rk1/pbpp1ppp/1p2p3/6B1/1bPPP1n1/2NB1N2/PPQ2PPP/R4RK1 b - - 8 9', 'current_board': 'rn1q1rk1/pbpp2pp/1p2pp2/6B1/1bPPP1n1/2NB1N2/PPQ2PPP/R4RK1 w - - 0 10', 'comment': ''}, {'previous_board': 'rn1q1rk1/pbpp2pp/1p2pp2/6B1/1bPPP1n1/2NB1N2/PPQ2PPP/R4RK1 w - - 0 10', 'current_board': 'rn1q1rk1/pbpp2pp/1p2pp2/8/1bPPP1nB/2NB1N2/PPQ2PPP/R4RK1 b - - 1 10', 'comment': 'other option was Bd2, but this is probably better. now white can do a number of interesting things, like e5'}, {'previous_board': 'rn1q1rk1/pbpp2pp/1p2pp2/8/1bPPP1nB/2NB1N2/PPQ2PPP/R4RK1 b - - 1 10', 'current_board': 'rn1q1rk1/pb1p2pp/1p2pp2/2p5/1bPPP1nB/2NB1N2/PPQ2PPP/R4RK1 w - - 0 11', 'comment': "good move. aims at breaking up white's pawn center."}, {'previous_board': 'rn1q1rk1/pb1p2pp/1p2pp2/2p5/1bPPP1nB/2NB1N2/PPQ2PPP/R4RK1 w - - 0 11', 'current_board': 'rn1q1rk1/pb1p2pp/1p2pp2/2p1P3/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 b - - 0 11', 'comment': "had to think a lot for this move. still unsure whether this was the best option. Other options were d5, a3 and h3. The ones I had to decide between in the end were e5 and d5. Both look good for white, but e5 has various very tactical lines. d5 locks the position, and the game develops slower. i think that the advantage is more sure with d5, but would be slow to convert into anything tangible. it would most probably be followed by d6, and exchange of the bishop for knight by black on c3. With e5, black's best reply seems to be cxd4. Bxf3 is also good. After Bxf3, white's pawns double, exposing the king on an open g file. After cxd4, white could play exf6 or Bxh7, both of which look good. Probably moving the c knight at some point would be a good idea, to avoid black exchaninging it for a useless bishop."}, {'previous_board': 'rn1q1rk1/pb1p2pp/1p2pp2/2p1P3/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 b - - 0 11', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pp2/2p1P3/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 w - - 1 12', 'comment': "interesting move. i did not expect it. prevents white from taking on h7 with check. however, i think that it is a 'slow' move, and black needed a 'fast' move at this time. now white can simply play exf6, and black would be forced to play Nxf6 or gxf6 (otherwise white wins the black Q). Nxf6 definately looks the better of the two. After that white can decide about what to do with black's threat of cxd4. Options would include Ne4, Ne5, a3, Bxh7 etc.."}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pp2/2p1P3/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 w - - 1 12', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pP2/2p5/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 b - - 0 12', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pP2/2p5/1bPP2nB/2NB1N2/PPQ2PPP/R4RK1 b - - 0 12', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pn2/2p5/1bPP3B/2NB1N2/PPQ2PPP/R4RK1 w - - 0 13', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pn2/2p5/1bPP3B/2NB1N2/PPQ2PPP/R4RK1 w - - 0 13', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pn2/2p5/1bPPN2B/3B1N2/PPQ2PPP/R4RK1 b - - 1 13', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pn2/2p5/1bPPN2B/3B1N2/PPQ2PPP/R4RK1 b - - 1 13', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pn2/8/1bPpN2B/3B1N2/PPQ2PPP/R4RK1 w - - 0 14', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pn2/8/1bPpN2B/3B1N2/PPQ2PPP/R4RK1 w - - 0 14', 'current_board': 'rn1q1r1k/pb1p2pp/1p2pN2/8/1bPp3B/3B1N2/PPQ2PPP/R4RK1 b - - 0 14', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p2pp/1p2pN2/8/1bPp3B/3B1N2/PPQ2PPP/R4RK1 b - - 0 14', 'current_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPp3B/3B1N2/PPQ2PPP/R4RK1 w - - 0 15', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPp3B/3B1N2/PPQ2PPP/R4RK1 w - - 0 15', 'current_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPN3B/3B4/PPQ2PPP/R4RK1 b - - 0 15', 'comment': ''}, {'previous_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPN3B/3B4/PPQ2PPP/R4RK1 b - - 0 15', 'current_board': 'rn3r1k/pbqp3p/1p2pp2/8/1bPN3B/3B4/PPQ2PPP/R4RK1 w - - 1 16', 'comment': "the space around black's king has opened up. however, black now also has open files to place his rooks on to attack white's king in conjunction with his bishops. however black's N is still undeveloped."}, {'previous_board': 'rn3r1k/pbqp3p/1p2pp2/8/1bPN3B/3B4/PPQ2PPP/R4RK1 w - - 1 16', 'current_board': 'rn3r1k/pbqp3p/1p2pp2/8/1bPN4/3B2B1/PPQ2PPP/R4RK1 b - - 2 16', 'comment': ''}, {'previous_board': 'rn3r1k/pbqp3p/1p2pp2/8/1bPN4/3B2B1/PPQ2PPP/R4RK1 b - - 2 16', 'current_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPN4/3B2B1/PPQ2PPP/R4RK1 w - - 3 17', 'comment': 'maybe Qc5 would have been better'}, {'previous_board': 'rn1q1r1k/pb1p3p/1p2pp2/8/1bPN4/3B2B1/PPQ2PPP/R4RK1 w - - 3 17', 'current_board': 'rn1q1r1k/pb1p3p/1p2pp2/1N6/1bP5/3B2B1/PPQ2PPP/R4RK1 b - - 4 17', 'comment': "with the aim of lodging in at d6. black should next play a move which blocks white's black B, or opens space around his rook, otherwise white can win the exchange by playing Nc7. 17..f5 looks to be the best for black. This sequence of moves leaves white's white B weaker."}, {'previous_board': 'rn1q1r1k/pb1p3p/1p2pp2/1N6/1bP5/3B2B1/PPQ2PPP/R4RK1 b - - 4 17', 'current_board': 'rn1q1r1k/1b1p3p/pp2pp2/1N6/1bP5/3B2B1/PPQ2PPP/R4RK1 w - - 0 18', 'comment': 'opens space around rook, and scares the N off'}, {'previous_board': 'rn1q1r1k/1b1p3p/pp2pp2/1N6/1bP5/3B2B1/PPQ2PPP/R4RK1 w - - 0 18', 'current_board': 'rn1q1r1k/1b1p3p/pp1Npp2/8/1bP5/3B2B1/PPQ2PPP/R4RK1 b - - 1 18', 'comment': ''}, {'previous_board': 'rn1q1r1k/1b1p3p/pp1Npp2/8/1bP5/3B2B1/PPQ2PPP/R4RK1 b - - 1 18', 'current_board': 'rn1q1r1k/1b1p3p/pp1bpp2/8/2P5/3B2B1/PPQ2PPP/R4RK1 w - - 0 19', 'comment': "Black exchanges his weak black B for white's N which would have cramped things for black had it stayed on d6. However, white is now left with 2 bishops, which could work well to dominate the board"}, {'previous_board': 'rn1q1r1k/1b1p3p/pp1bpp2/8/2P5/3B2B1/PPQ2PPP/R4RK1 w - - 0 19', 'current_board': 'rn1q1r1k/1b1p3p/pp1Bpp2/8/2P5/3B4/PPQ2PPP/R4RK1 b - - 0 19', 'comment': ''}, {'previous_board': 'rn1q1r1k/1b1p3p/pp1Bpp2/8/2P5/3B4/PPQ2PPP/R4RK1 b - - 0 19', 'current_board': 'rn1q2rk/1b1p3p/pp1Bpp2/8/2P5/3B4/PPQ2PPP/R4RK1 w - - 1 20', 'comment': ''}, {'previous_board': 'rn1q2rk/1b1p3p/pp1Bpp2/8/2P5/3B4/PPQ2PPP/R4RK1 w - - 1 20', 'current_board': 'rn1q2rk/1b1p3p/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/R4RK1 b - - 0 20', 'comment': ''}, {'previous_board': 'rn1q2rk/1b1p3p/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/R4RK1 b - - 0 20', 'current_board': 'rn1q3k/1b1p2rp/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/R4RK1 w - - 1 21', 'comment': "to protect Bxh7. But now black cannot play f5 (which would have reduced white's white B's mobility and strengthened the f-pawn) since black's rook and king are on the same diagonal."}, {'previous_board': 'rn1q3k/1b1p2rp/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/R4RK1 w - - 1 21', 'current_board': 'rn1q3k/1b1p2rp/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/3R1RK1 b - - 2 21', 'comment': 'rook to semi-open file.'}, {'previous_board': 'rn1q3k/1b1p2rp/pp1Bpp2/8/2P5/3B1P2/PPQ3PP/3R1RK1 b - - 2 21', 'current_board': 'r2q3k/1b1p2rp/ppnBpp2/8/2P5/3B1P2/PPQ3PP/3R1RK1 w - - 3 22', 'comment': 'black develops N at last!'}, {'previous_board': 'r2q3k/1b1p2rp/ppnBpp2/8/2P5/3B1P2/PPQ3PP/3R1RK1 w - - 3 22', 'current_board': 'r2q3k/1b1p2rp/ppnBpp2/8/2P1B3/5P2/PPQ3PP/3R1RK1 b - - 4 22', 'comment': "pins N. opens up space for R to exert influence. Cheekily invites f5 from black. Black's camp is now quite cramped. The N can't move, the Q has few squares to go to, and must protect f6. Black has to think of a way to liberate himself, and white has to think of a way to use the space he has to attack."}, {'previous_board': 'r2q3k/1b1p2rp/ppnBpp2/8/2P1B3/5P2/PPQ3PP/3R1RK1 b - - 4 22', 'current_board': '2rq3k/1b1p2rp/ppnBpp2/8/2P1B3/5P2/PPQ3PP/3R1RK1 w - - 5 23', 'comment': ''}, {'previous_board': '2rq3k/1b1p2rp/ppnBpp2/8/2P1B3/5P2/PPQ3PP/3R1RK1 w - - 5 23', 'current_board': '2rq3k/1b1p2rp/ppnBpp2/8/2P1B3/1P3P2/P1Q3PP/3R1RK1 b - - 0 23', 'comment': "protects the c-pawn against a potential Na5. The 2 general concepts in my mind at this time were to weaken the black pawns by moving my f-pawn up the board. This threat is quite real and near, so black should move his king and play f5 as soon as possible. If white had played f4 immediately, then 23..Na5 24.b3 Bxe4 25.Qxe4 f5, and black is now less cramped, and white hasn't succeeded in weakening black's center pawns as he would have wished. The other thing I wanted to do was to double up on the d-file, and exert pressure on black's backward d-pawn."}, {'previous_board': '2rq3k/1b1p2rp/ppnBpp2/8/2P1B3/1P3P2/P1Q3PP/3R1RK1 b - - 0 23', 'current_board': '2rq3k/1b1p2rp/pp1Bpp2/n7/2P1B3/1P3P2/P1Q3PP/3R1RK1 w - - 1 24', 'comment': "Black most probably played this to make his position more 'fluid' - to free his pieces. However the N has no squares where it is currently at. Black would be aiming to exchange bishops, and then play the N to b7, or maybe even c6."}, {'previous_board': '2rq3k/1b1p2rp/pp1Bpp2/n7/2P1B3/1P3P2/P1Q3PP/3R1RK1 w - - 1 24', 'current_board': '2rq3k/1b1p2rp/pp1Bpp2/n7/2P1B3/1P3P2/P1Q2RPP/3R2K1 b - - 2 24', 'comment': 'With the aim of doubling on the d-file. Once the rooks are doubled, white can move the B from d6, and bring it to the long diagonal where it would be powerful. Also, the Q would be protecting both, d7 and f6, which could cause black problems.'}, {'previous_board': '2rq3k/1b1p2rp/pp1Bpp2/n7/2P1B3/1P3P2/P1Q2RPP/3R2K1 b - - 2 24', 'current_board': '2rq3k/3p2rp/ppbBpp2/n7/2P1B3/1P3P2/P1Q2RPP/3R2K1 w - - 3 25', 'comment': 'makes room for the N. Alternatively black could have played 24..Bxe4'}, {'previous_board': '2rq3k/3p2rp/ppbBpp2/n7/2P1B3/1P3P2/P1Q2RPP/3R2K1 w - - 3 25', 'current_board': '2rq3k/3p2rp/ppbBpp2/n7/2P1B3/1P3P2/P1QR2PP/3R2K1 b - - 4 25', 'comment': ''}, {'previous_board': '2rq3k/3p2rp/ppbBpp2/n7/2P1B3/1P3P2/P1QR2PP/3R2K1 b - - 4 25', 'current_board': '2rq3k/1n1p2rp/ppbBpp2/8/2P1B3/1P3P2/P1QR2PP/3R2K1 w - - 5 26', 'comment': "At this point I had to make a few important decisions. First of all I had to decide whether I wanted black to take my B. Nxd6 would leave me without my dark bishop. In this position, the dark bishop appears to be quite powerful. Placed on the a1-h8 diagonal, it could cause black problems. However if I moved the bishop, after a few moves black could advance the d-pawn (but if Nxd6, then Rxd6 keeps the d-pawn back, and weak). And there were also 2 options if I decided to move my B - I could either bring it to the b2 square through a3, or I could take it to f4, and then play Bh6 at some point. So at this junction, I was considering 3 moves: Ba3, Bf4 and a move in which I wouldn't move my B, probably Qb2"}, {'previous_board': '2rq3k/1n1p2rp/ppbBpp2/8/2P1B3/1P3P2/P1QR2PP/3R2K1 w - - 5 26', 'current_board': '2rq3k/1n1p2rp/ppb1pp2/8/2P1B3/BP3P2/P1QR2PP/3R2K1 b - - 6 26', 'comment': "This was a very difficult decision for me. I didn't play Qb2 because e5 by black didn't look good. I also didn't want to exchange much material right now, because I fealt that the pressure was on black, and exchanges would let some of the steam off. I didn't play Bf4 because it didn't seem to do much. Now black may be able to play d5 at some point, which would give him space, and strengthen his d-pawn. However white's bishop would be strong at b2."}, {'previous_board': '2rq3k/1n1p2rp/ppb1pp2/8/2P1B3/BP3P2/P1QR2PP/3R2K1 b - - 6 26', 'current_board': '2rq3k/1n4rp/ppb1pp2/3p4/2P1B3/BP3P2/P1QR2PP/3R2K1 w - - 0 27', 'comment': ''}, {'previous_board': '2rq3k/1n4rp/ppb1pp2/3p4/2P1B3/BP3P2/P1QR2PP/3R2K1 w - - 0 27', 'current_board': '2rq3k/1n4rp/ppb1pp2/3P4/4B3/BP3P2/P1QR2PP/3R2K1 b - - 0 27', 'comment': ''}, {'previous_board': '2rq3k/1n4rp/ppb1pp2/3P4/4B3/BP3P2/P1QR2PP/3R2K1 b - - 0 27', 'current_board': '2rq3k/1n4rp/pp2pp2/3b4/4B3/BP3P2/P1QR2PP/3R2K1 w - - 0 28', 'comment': ''}, {'previous_board': '2rq3k/1n4rp/pp2pp2/3b4/4B3/BP3P2/P1QR2PP/3R2K1 w - - 0 28', 'current_board': '2rq3k/1n4rp/pp2pp2/3b4/4B3/BP3P2/P2R2PP/1Q1R2K1 b - - 1 28', 'comment': ''}, {'previous_board': '2rq3k/1n4rp/pp2pp2/3b4/4B3/BP3P2/P2R2PP/1Q1R2K1 b - - 1 28', 'current_board': '2rq3k/1n1r3p/pp2pp2/3b4/4B3/BP3P2/P2R2PP/1Q1R2K1 w - - 2 29', 'comment': ''}, {'previous_board': '2rq3k/1n1r3p/pp2pp2/3b4/4B3/BP3P2/P2R2PP/1Q1R2K1 w - - 2 29', 'current_board': '2rq3k/1n1r3p/pp2pp2/3b4/4B3/1P3P2/PB1R2PP/1Q1R2K1 b - - 3 29', 'comment': ''}, {'previous_board': '2rq3k/1n1r3p/pp2pp2/3b4/4B3/1P3P2/PB1R2PP/1Q1R2K1 b - - 3 29', 'current_board': '3q3k/1n1r3p/pp2pp2/2rb4/4B3/1P3P2/PB1R2PP/1Q1R2K1 w - - 4 30', 'comment': ''}, {'previous_board': '3q3k/1n1r3p/pp2pp2/2rb4/4B3/1P3P2/PB1R2PP/1Q1R2K1 w - - 4 30', 'current_board': '3q3k/1n1r3p/pp2pp2/2rb4/4B3/1P1Q1P2/PB1R2PP/3R2K1 b - - 5 30', 'comment': 'Attacks a6, and threatens Qe3. After Qe3 white could play Bxd5, with the white Q eventually taking on e6, and leaving the black king in real danger. Maybe it was a bit premature for black to resign - the position however, does favour white quite heavily.'}])
        crawler.main.crawl('', '')
        args, kwargs = mock_write_parquet.call_args
        df = args[0]
        self.assertEqual(df.rows(), expected.rows())
        