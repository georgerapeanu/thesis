@startuml
!pragma teoz true

participant TopKComponent 
participant ModelBackendService 
participant GameStateService 
participant NGINX 
participant Proxy 
participant Model 

activate ModelBackendService
||0||
opt Model settings changed
  ModelBackendService -> ModelBackendService: Notify settings change. 
end
opt game state changed
  GameStateService -> ModelBackendService: Notify game state change. 
end

ModelBackendService -> NGINX ++: Request top 10 for current game state and model settings.
NGINX -> Proxy ++: Forward request to proxy.
Proxy -> Proxy: Validate request.
alt Request is invalid.
  Proxy --> NGINX: Return error.
else
  alt Next token is cached
    Proxy -> Proxy: Return top 10 response.
  else
    Proxy -> Model ++: Forward request.
    Model -> Model: Validate request.
    alt Request is invalid
      Model --> Proxy: Return error.
    else
      Model --> Proxy --: Return commentary execution.
      Proxy -> Proxy: Cache commentary execution.
    end
    Proxy --> NGINX --: Return response.
  end
end
NGINX --> ModelBackendService --: Return response.
ModelBackendService --> TopKComponent--: Return response.
||0||
deactivate ModelBackendService 



@enduml

